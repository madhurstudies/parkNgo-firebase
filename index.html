<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Park N Go ‚Äì Smart Parking Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
--bg:#ffffff;
--panel:#f8f9fa;
--gold:#f4c463;
--blue:#3b82f6;
--red:#ef4444;
--green:#22c55e;
--purple:#a855f7;
--orange:#f97316;
--muted:#64748b;
--text:#1e293b;
--border:#e2e8f0;
--card-bg:#ffffff;
--input-bg:#f8f9fa;
--nav-text:#475569;
}

[data-theme="dark"] {
--bg:#0a0e1a;
--panel:#1a1f2e;
--gold:#f4c463;
--blue:#3b82f6;
--red:#ef4444;
--green:#22c55e;
--purple:#a855f7;
--orange:#f97316;
--muted:#94a3b8;
--text:#e2e8f0;
--border:#2d3748;
--card-bg:#1a1f2e;
--input-bg:#0f1419;
--nav-text:#cbd5e1;
}

*{box-sizing:border-box;font-family:Inter,system-ui}
body{
margin:0;
background:var(--bg);
color:var(--text);
min-height:100vh;
transition: background-color 0.3s, color 0.3s;
}

/* ================= NAV ================= */
.top-nav{
position:sticky;
top:0;
z-index:200;
display:flex;
justify-content:space-between;
align-items:center;
padding:18px 50px;
background:var(--bg);
backdrop-filter:blur(12px);
border-bottom:2px solid var(--border);
box-shadow: 0 2px 10px rgba(0,0,0,.05);
transition: all 0.3s;
}

.brand{
font-weight:900;
font-size:1.3rem;
background: linear-gradient(135deg, var(--gold), #eab308);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
letter-spacing:1px;
}

.nav-right{
display:flex;
gap:26px;
font-size:.85rem;
color:var(--nav-text);
align-items: center;
}

.theme-toggle {
width: auto;
padding: 8px 16px;
background: var(--panel);
border: 2px solid var(--border);
border-radius: 20px;
cursor: pointer;
transition: all 0.3s;
display: flex;
align-items: center;
gap: 8px;
}

.theme-toggle:hover {
transform: scale(1.05);
border-color: var(--gold);
box-shadow: 0 4px 12px rgba(244,196,99,.2);
}

.theme-icon {
font-size: 1.2rem;
}

.nav-item{
position:relative;
cursor:pointer;
transition: all .3s;
padding: 8px 12px;
border-radius: 8px;
}

.nav-item:hover{
color:var(--text);
background: rgba(244,196,99,.15);
}

.nav-dropdown{
display:none;
position:absolute;
top:46px;
right:0;
width:360px;
background:var(--card-bg);
padding:20px;
border-radius:16px;
box-shadow:0 10px 40px rgba(0,0,0,.15);
border: 1px solid var(--border);
}

.nav-item:hover .nav-dropdown{display:block}

.nav-dropdown h4{
color:var(--text);
margin-bottom:12px;
font-size:.95rem;
}

.nav-dropdown p,
.nav-dropdown li{
font-size:.78rem;
color:var(--muted);
margin-bottom:8px;
line-height:1.5;
}

.nav-dropdown ul {
list-style: none;
padding: 0;
}

.nav-dropdown li::before {
content: "‚úì ";
color: var(--green);
font-weight: bold;
margin-right: 8px;
}

.price-box{
background:var(--panel);
border:1px solid var(--border);
border-radius:12px;
padding:12px;
margin-bottom:10px;
transition: all .3s;
}

.price-box:hover {
background:var(--input-bg);
border-color: var(--gold);
transform: translateX(4px);
}

/* ================= AUTH ================= */
#auth{
min-height:calc(100vh - 80px);
display:flex;
flex-direction: column;
align-items:center;
justify-content:center;
padding: 20px;
background: var(--panel);
}

.auth{
background:var(--card-bg);
padding:50px;
width:450px;
border-radius:26px;
box-shadow:0 10px 40px rgba(0,0,0,.1);
border: 1px solid var(--border);
}

.auth h2{
text-align:center;
background: linear-gradient(135deg, var(--gold), #eab308);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
margin-bottom:8px;
font-size: 1.8rem;
}

.auth p{
text-align:center;
font-size:.85rem;
color:var(--muted);
margin-bottom:28px;
}

.auth input,
.auth select{
width:100%;
padding:16px;
margin-bottom:16px;
background:var(--input-bg);
border:1px solid var(--border);
border-radius:12px;
color:var(--text);
font-size: .9rem;
transition: all .3s;
}

.auth input:focus,
.auth select:focus {
outline: none;
border-color: var(--gold);
background: var(--card-bg);
box-shadow: 0 0 0 3px rgba(244,196,99,.1);
}

button{
width:100%;
padding:16px;
border:none;
border-radius:14px;
font-weight:900;
cursor:pointer;
background:linear-gradient(135deg,#f4c463,#eab308);
font-size: .9rem;
transition: all .3s;
}

button:hover {
transform: translateY(-2px);
box-shadow: 0 8px 20px rgba(244,196,99,.3);
}

button:active {
transform: translateY(0);
}

/* ================= DRIVER AUTH ================= */
#driverAuth {
display: none;
min-height:calc(100vh - 80px);
flex-direction: column;
align-items:center;
justify-content:center;
padding: 20px;
background: var(--panel);
}

.driver-badge {
display: inline-block;
background: linear-gradient(135deg, var(--blue), #2563eb);
color: white;
padding: 6px 14px;
border-radius: 20px;
font-size: 0.75rem;
font-weight: 700;
margin-bottom: 16px;
}

/* ================= APP ================= */
#app{display:none}
#driverApp{display:none}

.dashboard{
display:grid;
grid-template-columns:280px 1fr;
min-height:100vh;
background:var(--panel);
}

.sidebar{
background:var(--card-bg);
padding:30px;
border-right:2px solid var(--border);
}

.stat{
margin-bottom:24px;
padding: 16px;
background: var(--panel);
border-radius: 12px;
border: 1px solid var(--border);
transition: all .3s;
}

.stat:hover {
background: var(--input-bg);
transform: translateX(4px);
box-shadow: 0 2px 8px rgba(0,0,0,.05);
}

.stat small{
color:var(--muted);
font-size: .75rem;
text-transform: uppercase;
letter-spacing: .5px;
}

.stat h2{
color:var(--text);
margin-top: 8px;
font-size: 1.8rem;
font-weight: 900;
}

.legend {
margin-top: 30px;
padding: 16px;
background: var(--panel);
border-radius: 12px;
border: 1px solid var(--border);
}

.legend h4 {
font-size: .8rem;
color: var(--muted);
margin-bottom: 12px;
text-transform: uppercase;
letter-spacing: .5px;
}

.legend-item {
display: flex;
align-items: center;
margin-bottom: 8px;
font-size: .8rem;
color: var(--nav-text);
}

.legend-color {
width: 20px;
height: 20px;
border-radius: 4px;
margin-right: 10px;
}

.main{padding:40px; background:var(--panel);}

.main h2 {
margin-bottom: 24px;
font-size: 1.6rem;
color:var(--text);
}

.grid-controls {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
padding: 16px;
background: var(--card-bg);
border-radius: 12px;
border: 1px solid var(--border);
box-shadow: 0 1px 3px rgba(0,0,0,.05);
}

.search-box {
padding: 10px 16px;
background: var(--input-bg);
border: 1px solid var(--border);
border-radius: 8px;
color: var(--text);
width: 200px;
}

.search-box:focus {
outline: none;
border-color: var(--gold);
background: var(--card-bg);
}

.filter-btn {
padding: 10px 20px;
width: auto;
font-size: .8rem;
margin-left: 10px;
}

.grid{
display:grid;
grid-template-columns:repeat(10,1fr);
gap:10px;
background:var(--card-bg);
padding:24px;
border-radius:20px;
border: 1px solid var(--border);
box-shadow: 0 1px 3px rgba(0,0,0,.05);
}

.spot{
height:52px;
border-radius:8px;
display:flex;
align-items:center;
justify-content:center;
font-size:.75rem;
font-weight: 700;
cursor:pointer;
border: 2px solid transparent;
transition: all .3s;
position: relative;
color: white;
}

.spot:hover:not(.reserved) {
transform: scale(1.05);
box-shadow: 0 4px 12px rgba(0,0,0,.2);
}

.free{
background:var(--input-bg);
border:2px solid var(--border);
color:var(--muted);
}

.reserved{
background:var(--purple);
cursor: not-allowed;
}

.booked{
background:var(--orange);
}

.parked{
background:var(--green);
}

.cab{
background:var(--blue);
}

@keyframes flash {
  0%, 100% { border-color: transparent; box-shadow: none; }
  50% { border-color: var(--gold); box-shadow: 0 0 20px rgba(244,196,99,.5); }
}

.expiring {
  animation: flash 1s infinite;
}

.spot-timer {
  position: absolute;
  bottom: 2px;
  font-size: .55rem;
  opacity: .8;
}

.discount-badge {
  position: absolute;
  top: -8px;
  right: -8px;
  background: var(--red);
  color: white;
  font-size: 0.6rem;
  padding: 2px 6px;
  border-radius: 8px;
  font-weight: 900;
}

/* ================= MODALS ================= */
.overlay{
position:fixed;
inset:0;
background:rgba(0,0,0,.6);
backdrop-filter: blur(8px);
display:none;
align-items:center;
justify-content:center;
z-index: 300;
}

.card{
position: relative;
background:var(--card-bg);
color:var(--text);
padding:40px;
border-radius:24px;
width:380px;
text-align:center;
box-shadow: 0 40px 100px rgba(0,0,0,.5);
border: 1px solid var(--border);
}

.card h3 {
font-size: 1.5rem;
margin-bottom: 8px;
}

.back-button {
position: absolute;
top: 20px;
left: 20px;
width: 36px;
height: 36px;
border-radius: 50%;
background: #eee;
color: black;
font-size: 1.4rem;
line-height: 1;
padding: 0;
border: none;
cursor: pointer;
transition: all .3s;
}

.back-button:hover {
background: #ddd;
transform: scale(1.1);
}

.hour-selector {
display: flex;
align-items: center;
justify-content: center;
margin: 28px 0;
}

.hour-selector button {
width: 44px;
height: 44px;
border-radius: 50%;
background: #eee;
color: black;
font-size: 1.6rem;
line-height: 1;
padding: 0;
border: none;
cursor: pointer;
transition: all .3s;
}

.hour-selector button:hover {
background: #ddd;
transform: scale(1.1);
}

.hour-selector span {
font-size: 2.5rem;
font-weight: bold;
padding: 0 30px;
min-width: 100px;
}

.card button {
margin-top: 12px;
}

.card button:first-of-type {
margin-top: 0;
}

.info-row {
display: flex;
justify-content: space-between;
padding: 12px;
background: var(--panel);
border-radius: 8px;
margin: 8px 0;
font-size: .9rem;
}

.info-label {
color: var(--muted);
}

.info-value {
font-weight: bold;
color: var(--text);
}

.discount-highlight {
background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1));
border: 2px solid var(--blue) !important;
position: relative;
}

.discount-highlight::after {
content: "60% OFF";
position: absolute;
top: -12px;
right: 8px;
background: var(--red);
color: white;
font-size: 0.65rem;
padding: 3px 8px;
border-radius: 10px;
font-weight: 900;
}

/* ================= RESPONSIVE ================= */
@media (max-width: 768px) {
  .dashboard {
    grid-template-columns: 1fr;
  }
  
  .sidebar {
    border-right: none;
    border-bottom: 1px solid rgba(255,255,255,.1);
  }
  
  .grid {
    grid-template-columns: repeat(5, 1fr);
  }
  
  .top-nav {
    padding: 18px 20px;
  }
  
  .nav-right {
    gap: 15px;
  }
  
  .auth {
    width: 90%;
    padding: 30px;
  }
}

</style>
</head>

<body>

<!-- NAV -->
<nav class="top-nav">
  <div class="brand">üöó PARK N GO</div>

  <div class="nav-right">
    <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode">
      <span class="theme-icon">üåô</span>
    </button>
    
    <div class="nav-item">About
      <div class="nav-dropdown">
        <h4>About Park N Go</h4>
        <p>Smart parking platform reducing congestion, uncertainty and revenue loss.</p>
        <p>Built for owners and Ola/Uber drivers.</p>
      </div>
    </div>

    <div class="nav-item">Features
      <div class="nav-dropdown">
        <h4>Platform Features</h4>
        <ul>
          <li>Real-time slot availability tracking</li>
          <li>Reserved parking management</li>
          <li>Instant booking system</li>
          <li>Time-based automated billing</li>
          <li>Overstay alerts with visual indicators</li>
          <li>Color-coded parking grid</li>
          <li>Separate rates for cabs vs regular</li>
          <li>Live revenue dashboard</li>
          <li>Spot search & filtering</li>
          <li>Historical parking data</li>
          <li>60% discount for Ola/Uber drivers</li>
        </ul>
      </div>
    </div>

    <div class="nav-item">Pricing
      <div class="nav-dropdown">
        <div class="price-box"><b>BASIC ‚Äì ‚Çπ999/month</b><br>50 parking spots</div>
        <div class="price-box"><b>PRO ‚Äì ‚Çπ2,999/month</b><br>150 parking spots</div>
        <div class="price-box"><b>ENTERPRISE ‚Äì ‚Çπ4,999/month</b><br>300+ parking spots</div>
        <div style="margin-top: 16px; padding: 12px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1)); border-radius: 8px; border: 1px solid var(--blue);">
          <b style="color: var(--blue);">üöï Driver Rate: ‚Çπ20/hour</b><br>
          <small style="color: var(--muted);">60% discount for Ola/Uber drivers</small>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- OWNER AUTH -->
<section id="auth">
<div class="auth">
<h2>Enter Platform</h2>
<p>Unified parking system for owners & drivers</p>
<input id="email" placeholder="Email Address">
<select id="plan">
<option value="50">BASIC ‚Äì 50 slots</option>
<option value="150">PRO ‚Äì 150 slots</option>
<option value="300">ENTERPRISE ‚Äì 300+ slots</option>
</select>
<button id="enterBtn">ENTER PLATFORM</button>
</div>
<button id="driverLoginBtn" style="margin-top: 20px; width: 450px; background: linear-gradient(135deg, var(--blue), #2563eb);">üöï Login as Ola/Uber Driver</button>
</section>

<!-- DRIVER AUTH -->
<section id="driverAuth">
<div class="auth">
<div class="driver-badge">üöï DRIVER PORTAL</div>
<h2>Driver Login</h2>
<p>60% discounted parking for Ola/Uber drivers</p>
<input id="driverName" placeholder="Full Name">
<input id="driverPhone" placeholder="Phone Number" type="tel">
<select id="driverType">
<option value="ola">Ola Driver</option>
<option value="uber">Uber Driver</option>
<option value="both">Both Ola & Uber</option>
</select>
<input id="driverVehicle" placeholder="Vehicle Number (e.g., MH12AB1234)">
<button id="driverEnterBtn" style="background: linear-gradient(135deg, var(--blue), #2563eb);">LOGIN & VIEW PARKING</button>
</div>
<button id="backToOwnerBtn" style="margin-top: 20px; width: 450px; background: linear-gradient(135deg, var(--gold), #eab308);">‚Üê Back to Owner Login</button>
</section>

<!-- OWNER APP -->
<section id="app">
<div class="dashboard">
<div class="sidebar">
<div class="stat"><small>Total Slots</small><h2 id="cap">0</h2></div>
<div class="stat"><small>Reserved</small><h2 id="reserved">0</h2></div>
<div class="stat"><small>Booked</small><h2 id="booked">0</h2></div>
<div class="stat"><small>Parked</small><h2 id="parked">0</h2></div>
<div class="stat"><small>Cabs</small><h2 id="cabs">0</h2></div>
<div class="stat"><small>Revenue</small><h2 id="rev">‚Çπ0</h2></div>
<button onclick="location.reload()" style="margin-top: 20px;">Logout</button>

<div class="legend">
  <h4>Legend</h4>
  <div class="legend-item">
    <div class="legend-color" style="background: var(--input-bg); border: 2px solid var(--border);"></div>
    <span>Available</span>
  </div>
  <div class="legend-item">
    <div class="legend-color" style="background: var(--purple);"></div>
    <span>Reserved</span>
  </div>
  <div class="legend-item">
    <div class="legend-color" style="background: var(--orange);"></div>
    <span>Booked</span>
  </div>
  <div class="legend-item">
    <div class="legend-color" style="background: var(--green);"></div>
    <span>Parked</span>
  </div>
  <div class="legend-item">
    <div class="legend-color" style="background: var(--blue);"></div>
    <span>Cab (Driver)</span>
  </div>
</div>
</div>

<div class="main">
<h2>Live Parking Grid</h2>

<div class="grid-controls">
  <input type="text" id="searchSpot" class="search-box" placeholder="Search spot number...">
  <div>
    <button class="filter-btn" id="filterAll">All</button>
    <button class="filter-btn" id="filterAvailable">Available</button>
    <button class="filter-btn" id="filterOccupied">Occupied</button>
  </div>
</div>

<div class="grid" id="grid"></div>
</div>
</div>
</section>

<!-- DRIVER APP -->
<section id="driverApp">
<div class="dashboard">
<div class="sidebar">
<div style="background: linear-gradient(135deg, var(--blue), #2563eb); padding: 20px; border-radius: 16px; margin-bottom: 24px; color: white; text-align: center;">
  <div style="font-size: 2rem; margin-bottom: 8px;">üöï</div>
  <h3 style="margin: 0; font-size: 1.1rem;" id="driverWelcome">Welcome, Driver!</h3>
  <p style="margin: 8px 0 0 0; font-size: 0.8rem; opacity: 0.9;" id="driverVehicleDisplay">MH12AB1234</p>
</div>

<div class="stat"><small>Available Spots</small><h2 id="driverAvailable">0</h2></div>
<div class="stat"><small>Your Bookings</small><h2 id="driverBookings">0</h2></div>
<div class="stat"><small>Total Spent</small><h2 id="driverSpent">‚Çπ0</h2></div>
<div class="stat" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1)); border: 2px solid var(--blue);">
  <small>Driver Rate</small>
  <h2 style="color: var(--blue);">‚Çπ20/hr</h2>
  <small style="color: var(--red); font-weight: 700;">60% OFF!</small>
</div>
<button onclick="location.reload()" style="margin-top: 20px;">Logout</button>

<div class="legend">
  <h4>Legend</h4>
  <div class="legend-item">
    <div class="legend-color" style="background: var(--input-bg); border: 2px solid var(--border);"></div>
    <span>Available</span>
  </div>
  <div class="legend-item">
    <div class="legend-color" style="background: var(--blue);"></div>
    <span>Your Booking</span>
  </div>
  <div class="legend-item">
    <div class="legend-color" style="background: var(--orange);"></div>
    <span>Occupied</span>
  </div>
</div>
</div>

<div class="main">
<h2>Available Parking Spots</h2>

<div class="grid-controls">
  <input type="text" id="driverSearchSpot" class="search-box" placeholder="Search spot number...">
  <div>
    <button class="filter-btn" id="driverFilterAll">All</button>
    <button class="filter-btn" id="driverFilterAvailable">Available Only</button>
  </div>
</div>

<div class="grid" id="driverGrid"></div>
</div>
</div>
</section>

<!-- OWNER BOOK MODAL -->
<div class="overlay" id="bookModal">
<div class="card">
<button id="backButton" class="back-button">‚Üê</button>
<h3>Book Spot <span id="selectedSpotNumber"></span></h3>
<p style="font-size: 0.85rem; color: #555; margin-top: 4px;">Select parking duration</p>
<div class="hour-selector">
    <button id="hourMinus">‚àí</button>
    <span id="hoursDisplay">2</span>
    <button id="hourPlus">+</button>
</div>
<input id="hours" type="hidden" value="2">
<div class="info-row">
  <span class="info-label">Regular Rate:</span>
  <span class="info-value">‚Çπ50/hour</span>
</div>
<div class="info-row">
  <span class="info-label">Cab Rate:</span>
  <span class="info-value">‚Çπ20/hour</span>
</div>
<button id="goPay" style="background: linear-gradient(135deg,#f4c463,#eab308);">Proceed to Pay (‚Çπ<span id="prePayAmount">100</span>)</button>
<button id="onsitePark" style="background: linear-gradient(135deg, var(--green), #16a34a);">Park On-site</button>
<button id="cabPark" style="background: linear-gradient(135deg, var(--blue), #2563eb);">Cab Parking</button>
<button id="reserveSpot" style="background: linear-gradient(135deg, var(--purple), #9333ea);">Reserve Spot</button>
</div>
</div>

<!-- DRIVER BOOK MODAL -->
<div class="overlay" id="driverBookModal">
<div class="card">
<button id="driverBackButton" class="back-button">‚Üê</button>
<div class="driver-badge" style="margin-bottom: 12px;">üöï DRIVER BOOKING</div>
<h3>Book Spot <span id="driverSelectedSpotNumber"></span></h3>
<p style="font-size: 0.85rem; color: #555; margin-top: 4px;">Discounted rate: ‚Çπ20/hour (60% OFF)</p>
<div class="hour-selector">
    <button id="driverHourMinus">‚àí</button>
    <span id="driverHoursDisplay">2</span>
    <button id="driverHourPlus">+</button>
</div>
<input id="driverHours" type="hidden" value="2">
<div class="info-row discount-highlight">
  <span class="info-label">Driver Rate:</span>
  <span class="info-value" style="color: var(--blue);">‚Çπ20/hour</span>
</div>
<div class="info-row" style="opacity: 0.5; text-decoration: line-through;">
  <span class="info-label">Regular Rate:</span>
  <span class="info-value">‚Çπ50/hour</span>
</div>
<div class="info-row" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(22, 163, 74, 0.1)); border: 1px solid var(--green);">
  <span class="info-label" style="color: var(--green); font-weight: 700;">You Save:</span>
  <span class="info-value" style="color: var(--green);">‚Çπ<span id="driverSavings">60</span></span>
</div>
<button id="driverPayNow" style="background: linear-gradient(135deg, var(--blue), #2563eb);">Pay ‚Çπ<span id="driverPayAmount">40</span></button>
</div>
</div>

<!-- PAYMENT MODAL (Razorpay-style) -->
<div class="overlay" id="payModal">
<div class="card" style="width: 480px; padding: 0; overflow: hidden;">
  <div style="background: #528FF0; padding: 20px; color: white; text-align: left;">
    <img src="https://upload.wikimedia.org/wikipedia/commons/8/89/Razorpay_logo.svg" width="100" style="filter: brightness(0) invert(1);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px;">
      <div>
        <div style="font-size: 0.85rem; opacity: 0.9;">Park N Go</div>
        <div style="font-size: 2rem; font-weight: bold; margin-top: 4px;">‚Çπ<span id="amt">0</span></div>
      </div>
      <div style="background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-size: 0.85rem;">
        üîí Secure
      </div>
    </div>
  </div>
  
  <div style="padding: 30px;">
    <div class="payment-tabs" style="display: flex; gap: 10px; margin-bottom: 24px; border-bottom: 2px solid #eee;">
      <div class="payment-tab active" data-tab="card" style="flex: 1; text-align: center; padding: 12px; cursor: pointer; border-bottom: 3px solid #528FF0; font-weight: 600; color: #528FF0;">
        üí≥ Card
      </div>
      <div class="payment-tab" data-tab="upi" style="flex: 1; text-align: center; padding: 12px; cursor: pointer; border-bottom: 3px solid transparent; color: #666;">
        üì± UPI
      </div>
      <div class="payment-tab" data-tab="netbanking" style="flex: 1; text-align: center; padding: 12px; cursor: pointer; border-bottom: 3px solid transparent; color: #666;">
        üè¶ Netbanking
      </div>
    </div>

    <!-- Card Payment -->
    <div id="cardPayment" class="payment-method" style="display: block;">
      <div style="margin-bottom: 16px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Card Number</label>
        <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
        <div>
          <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Valid Through</label>
          <input type="text" id="cardExpiry" placeholder="MM/YY" maxlength="5" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
        </div>
        <div>
          <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">CVV</label>
          <input type="password" id="cardCVV" placeholder="123" maxlength="3" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
        </div>
      </div>
      
      <div style="margin-bottom: 16px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Cardholder Name</label>
        <input type="text" id="cardName" placeholder="Name on Card" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 20px; font-size: 0.8rem; color: #666;">
        <input type="checkbox" id="saveCard" style="width: 16px; height: 16px;">
        <label for="saveCard">Securely save card for future payments</label>
      </div>
    </div>

    <!-- UPI Payment -->
    <div id="upiPayment" class="payment-method" style="display: none;">
      <div style="margin-bottom: 16px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Enter UPI ID</label>
        <input type="text" id="upiId" placeholder="yourname@paytm" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="text-align: center; margin: 24px 0; color: #666; font-size: 0.85rem;">OR</div>
      
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
        <div class="upi-option" style="border: 1px solid #ddd; border-radius: 12px; padding: 16px; text-align: center; cursor: pointer; transition: all 0.3s;">
          <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Crect fill='%235f259f' width='40' height='40' rx='8'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='white' font-size='20' font-weight='bold'%3EGP%3C/text%3E%3C/svg%3E" width="40" style="margin-bottom: 8px;">
          <div style="font-size: 0.75rem; font-weight: 600;">Google Pay</div>
        </div>
        <div class="upi-option" style="border: 1px solid #ddd; border-radius: 12px; padding: 16px; text-align: center; cursor: pointer; transition: all 0.3s;">
          <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Crect fill='%2300BAF2' width='40' height='40' rx='8'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='white' font-size='20' font-weight='bold'%3EPm%3C/text%3E%3C/svg%3E" width="40" style="margin-bottom: 8px;">
          <div style="font-size: 0.75rem; font-weight: 600;">Paytm</div>
        </div>
        <div class="upi-option" style="border: 1px solid #ddd; border-radius: 12px; padding: 16px; text-align: center; cursor: pointer; transition: all 0.3s;">
          <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Crect fill='%235F259F' width='40' height='40' rx='8'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='white' font-size='20' font-weight='bold'%3EPe%3C/text%3E%3C/svg%3E" width="40" style="margin-bottom: 8px;">
          <div style="font-size: 0.75rem; font-weight: 600;">PhonePe</div>
        </div>
      </div>
    </div>

    <!-- Netbanking Payment -->
    <div id="netbankingPayment" class="payment-method" style="display: none;">
      <div style="margin-bottom: 16px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Select Your Bank</label>
        <select id="bankSelect" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
          <option value="">Choose Bank</option>
          <option value="sbi">State Bank of India</option>
          <option value="hdfc">HDFC Bank</option>
          <option value="icici">ICICI Bank</option>
          <option value="axis">Axis Bank</option>
          <option value="kotak">Kotak Mahindra Bank</option>
          <option value="pnb">Punjab National Bank</option>
          <option value="other">Other Banks</option>
        </select>
      </div>
      
      <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; font-size: 0.8rem; color: #666; margin-top: 20px;">
        <strong>Note:</strong> You will be redirected to your bank's secure login page to complete the payment.
      </div>
    </div>

    <button id="payNowBtn" style="width: 100%; background: linear-gradient(135deg, #528FF0, #4a7fd9); color: white; padding: 16px; border: none; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer; margin-top: 24px;">
      Pay ‚Çπ<span id="amt2">0</span>
    </button>
    
    <button id="cancelPayBtn" style="width: 100%; background: #f1f1f1; color: #333; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 12px;">
      Cancel
    </button>
    
    <div style="text-align: center; margin-top: 20px; font-size: 0.75rem; color: #999;">
      üîí Payments are 100% secure and encrypted
    </div>
  </div>
</div>
</div>

<!-- PARKED INFO MODAL -->
<div class="overlay" id="parkedInfoModal">
  <div class="card">
    <h3>Parking Details</h3>
    <div class="info-row">
      <span class="info-label">Spot:</span>
      <span class="info-value" id="infoSpotNumber"></span>
    </div>
    <div class="info-row">
      <span class="info-label">Duration:</span>
      <span class="info-value" id="parkedTime"></span>
    </div>
    <div class="info-row">
      <span class="info-label">Current Charges:</span>
      <span class="info-value" id="currentCharges">‚Çπ0</span>
    </div>
    <button id="parkOutButton" style="background: linear-gradient(135deg, var(--red), #dc2626);">Check Out & Pay</button>
    <button id="closeParkedInfo" style="background: #ddd; color: #333;">Close</button>
  </div>
</div>

<!-- BOOKED INFO MODAL -->
<div class="overlay" id="bookedInfoModal">
  <div class="card">
    <h3>Booking Details</h3>
    <div class="info-row">
      <span class="info-label">Spot:</span>
      <span class="info-value" id="bookedSpotNumber"></span>
    </div>
    <div class="info-row">
      <span class="info-label">Booked For:</span>
      <span class="info-value" id="bookedHours"></span>
    </div>
    <div class="info-row">
      <span class="info-label">Amount Paid:</span>
      <span class="info-value" id="bookedAmount">‚Çπ0</span>
    </div>
    <button id="cancelBooking" style="background: linear-gradient(135deg, var(--red), #dc2626);">Cancel Booking</button>
    <button id="closeBookedInfo" style="background: #ddd; color: #333;">Close</button>
  </div>
</div>

<!-- BANK LOGIN SCREENS -->
<!-- SBI Bank -->
<div class="overlay" id="sbiBankModal">
  <div class="card" style="width: 450px; padding: 0; overflow: hidden;">
    <div style="background: #1C4A93; padding: 25px; color: white; text-align: center;">
      <h2 style="margin: 0; font-size: 1.8rem;">State Bank of India</h2>
      <p style="margin: 5px 0 0 0; font-size: 0.85rem; opacity: 0.9;">Retail Internet Banking</p>
    </div>
    
    <div style="padding: 35px; background: white;">
      <h3 style="color: #1e293b; margin-bottom: 25px; text-align: center;">Login to Continue Payment</h3>
      
      <div style="margin-bottom: 18px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Username</label>
        <input type="text" class="bank-input" placeholder="Enter your username" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="margin-bottom: 18px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Password</label>
        <input type="password" class="bank-input" placeholder="Enter your password" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="background: #f0f7ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #1C4A93;">
        <div style="font-size: 0.85rem; color: #1C4A93; margin-bottom: 5px;"><strong>Payment Amount:</strong></div>
        <div style="font-size: 1.5rem; font-weight: bold; color: #1C4A93;">‚Çπ<span class="bank-amount">0</span></div>
        <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">To: Park N Go Parking Services</div>
      </div>
      
      <button class="bank-login-btn" data-bank="sbi" style="width: 100%; background: #1C4A93; color: white; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px;">
        Login & Pay
      </button>
      
      <button class="bank-cancel-btn" style="width: 100%; background: #ddd; color: #333; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
        Cancel
      </button>
    </div>
  </div>
</div>

<!-- HDFC Bank -->
<div class="overlay" id="hdfcBankModal">
  <div class="card" style="width: 450px; padding: 0; overflow: hidden;">
    <div style="background: linear-gradient(135deg, #004C8F, #0066B2); padding: 25px; color: white; text-align: center;">
      <h2 style="margin: 0; font-size: 1.8rem;">HDFC Bank</h2>
      <p style="margin: 5px 0 0 0; font-size: 0.85rem; opacity: 0.9;">NetBanking</p>
    </div>
    
    <div style="padding: 35px; background: white;">
      <h3 style="color: #1e293b; margin-bottom: 25px; text-align: center;">Secure Login</h3>
      
      <div style="margin-bottom: 18px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Customer ID</label>
        <input type="text" class="bank-input" placeholder="Enter Customer ID" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="margin-bottom: 18px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Password</label>
        <input type="password" class="bank-input" placeholder="Enter Password" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="background: #e6f3ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #0066B2;">
        <div style="font-size: 0.85rem; color: #004C8F; margin-bottom: 5px;"><strong>Payment Details:</strong></div>
        <div style="font-size: 1.5rem; font-weight: bold; color: #004C8F;">‚Çπ<span class="bank-amount">0</span></div>
        <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">Merchant: Park N Go</div>
      </div>
      
      <button class="bank-login-btn" data-bank="hdfc" style="width: 100%; background: linear-gradient(135deg, #004C8F, #0066B2); color: white; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px;">
        Continue
      </button>
      
      <button class="bank-cancel-btn" style="width: 100%; background: #ddd; color: #333; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
        Cancel
      </button>
    </div>
  </div>
</div>

<!-- ICICI Bank -->
<div class="overlay" id="iciciBankModal">
  <div class="card" style="width: 450px; padding: 0; overflow: hidden;">
    <div style="background: linear-gradient(135deg, #B94700, #E65100); padding: 25px; color: white; text-align: center;">
      <h2 style="margin: 0; font-size: 1.8rem;">ICICI Bank</h2>
      <p style="margin: 5px 0 0 0; font-size: 0.85rem; opacity: 0.9;">Internet Banking</p>
    </div>
    
    <div style="padding: 35px; background: white;">
      <h3 style="color: #1e293b; margin-bottom: 25px; text-align: center;">Login</h3>
      
      <div style="margin-bottom: 18px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">User ID</label>
        <input type="text" class="bank-input" placeholder="User ID" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="margin-bottom: 18px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Password</label>
        <input type="password" class="bank-input" placeholder="Password" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #E65100;">
        <div style="font-size: 0.85rem; color: #B94700; margin-bottom: 5px;"><strong>Payment Summary:</strong></div>
        <div style="font-size: 1.5rem; font-weight: bold; color: #B94700;">‚Çπ<span class="bank-amount">0</span></div>
        <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">Payee: Park N Go Services</div>
      </div>
      
      <button class="bank-login-btn" data-bank="icici" style="width: 100%; background: linear-gradient(135deg, #B94700, #E65100); color: white; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px;">
        Login & Proceed
      </button>
      
      <button class="bank-cancel-btn" style="width: 100%; background: #ddd; color: #333; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
        Cancel
      </button>
    </div>
  </div>
</div>

<!-- Axis Bank -->
<div class="overlay" id="axisBankModal">
  <div class="card" style="width: 450px; padding: 0; overflow: hidden;">
    <div style="background: linear-gradient(135deg, #800020, #A4243B); padding: 25px; color: white; text-align: center;">
      <h2 style="margin: 0; font-size: 1.8rem;">Axis Bank</h2>
      <p style="margin: 5px 0 0 0; font-size: 0.85rem; opacity: 0.9;">Internet Banking</p>
    </div>
    
    <div style="padding: 35px; background: white;">
      <h3 style="color: #1e293b; margin-bottom: 25px; text-align: center;">Customer Login</h3>
      
      <div style="margin-bottom: 18px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Customer ID</label>
        <input type="text" class="bank-input" placeholder="Enter Customer ID" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="margin-bottom: 18px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Password</label>
        <input type="password" class="bank-input" placeholder="Enter Password" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="background: #ffe6eb; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #A4243B;">
        <div style="font-size: 0.85rem; color: #800020; margin-bottom: 5px;"><strong>Transaction Amount:</strong></div>
        <div style="font-size: 1.5rem; font-weight: bold; color: #800020;">‚Çπ<span class="bank-amount">0</span></div>
        <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">Beneficiary: Park N Go</div>
      </div>
      
      <button class="bank-login-btn" data-bank="axis" style="width: 100%; background: linear-gradient(135deg, #800020, #A4243B); color: white; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px;">
        Proceed to Pay
      </button>
      
      <button class="bank-cancel-btn" style="width: 100%; background: #ddd; color: #333; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
        Cancel
      </button>
    </div>
  </div>
</div>

<!-- Kotak Bank -->
<div class="overlay" id="kotakBankModal">
  <div class="card" style="width: 450px; padding: 0; overflow: hidden;">
    <div style="background: linear-gradient(135deg, #ED1C24, #FF4444); padding: 25px; color: white; text-align: center;">
      <h2 style="margin: 0; font-size: 1.8rem;">Kotak Mahindra Bank</h2>
      <p style="margin: 5px 0 0 0; font-size: 0.85rem; opacity: 0.9;">Net Banking</p>
    </div>
    
    <div style="padding: 35px; background: white;">
      <h3 style="color: #1e293b; margin-bottom: 25px; text-align: center;">Login</h3>
      
      <div style="margin-bottom: 18px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">User ID</label>
        <input type="text" class="bank-input" placeholder="Enter User ID" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="margin-bottom: 18px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Password</label>
        <input type="password" class="bank-input" placeholder="Enter Password" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="background: #ffebee; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ED1C24;">
        <div style="font-size: 0.85rem; color: #ED1C24; margin-bottom: 5px;"><strong>Payment Amount:</strong></div>
        <div style="font-size: 1.5rem; font-weight: bold; color: #ED1C24;">‚Çπ<span class="bank-amount">0</span></div>
        <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">To: Park N Go Parking</div>
      </div>
      
      <button class="bank-login-btn" data-bank="kotak" style="width: 100%; background: linear-gradient(135deg, #ED1C24, #FF4444); color: white; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px;">
        Login & Pay
      </button>
      
      <button class="bank-cancel-btn" style="width: 100%; background: #ddd; color: #333; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
        Cancel
      </button>
    </div>
  </div>
</div>

<!-- PNB Bank -->
<div class="overlay" id="pnbBankModal">
  <div class="card" style="width: 450px; padding: 0; overflow: hidden;">
    <div style="background: linear-gradient(135deg, #003087, #0056D6); padding: 25px; color: white; text-align: center;">
      <h2 style="margin: 0; font-size: 1.8rem;">Punjab National Bank</h2>
      <p style="margin: 5px 0 0 0; font-size: 0.85rem; opacity: 0.9;">Retail Internet Banking</p>
    </div>
    
    <div style="padding: 35px; background: white;">
      <h3 style="color: #1e293b; margin-bottom: 25px; text-align: center;">Login</h3>
      
      <div style="margin-bottom: 18px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">User ID</label>
        <input type="text" class="bank-input" placeholder="Enter User ID" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="margin-bottom: 18px;">
        <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">Password</label>
        <input type="password" class="bank-input" placeholder="Enter Password" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; color: #1e293b;">
      </div>
      
      <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #0056D6;">
        <div style="font-size: 0.85rem; color: #003087; margin-bottom: 5px;"><strong>Payment Amount:</strong></div>
        <div style="font-size: 1.5rem; font-weight: bold; color: #003087;">‚Çπ<span class="bank-amount">0</span></div>
        <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">Merchant: Park N Go</div>
      </div>
      
      <button class="bank-login-btn" data-bank="pnb" style="width: 100%; background: linear-gradient(135deg, #003087, #0056D6); color: white; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px;">
        Continue Payment
      </button>
      
      <button class="bank-cancel-btn" style="width: 100%; background: #ddd; color: #333; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
        Cancel
      </button>
    </div>
  </div>
</div>

<script>
const state = {
  user: null,
  spots: [],
  selected: null,
  revenue: 0,
  filter: 'all',
  isDriver: false,
  driverInfo: null,
  driverBookings: [],
  driverSpent: 0
};

// Theme toggle
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.querySelector('.theme-icon');
const savedTheme = localStorage.getItem('theme') || 'light';
document.documentElement.setAttribute('data-theme', savedTheme);
themeIcon.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

themeToggle.onclick = () => {
  const currentTheme = document.documentElement.getAttribute('data-theme');
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
  themeIcon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
};

// Auth Navigation
document.getElementById('driverLoginBtn').onclick = () => {
  document.getElementById('auth').style.display = 'none';
  document.getElementById('driverAuth').style.display = 'flex';
};

document.getElementById('backToOwnerBtn').onclick = () => {
  document.getElementById('driverAuth').style.display = 'none';
  document.getElementById('auth').style.display = 'flex';
};

// Owner Login
document.getElementById('enterBtn').onclick = () => {
  state.user = { capacity: +document.getElementById('plan').value };
  state.isDriver = false;
  initSpots();
  document.getElementById('auth').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  render();
};

// Driver Login
document.getElementById('driverEnterBtn').onclick = () => {
  const name = document.getElementById('driverName').value;
  const phone = document.getElementById('driverPhone').value;
  const type = document.getElementById('driverType').value;
  const vehicle = document.getElementById('driverVehicle').value;
  
  if (!name || !phone || !vehicle) {
    alert('Please fill in all fields');
    return;
  }
  
  state.driverInfo = { name, phone, type, vehicle };
  state.isDriver = true;
  state.user = { capacity: 100 }; // Default capacity for driver view
  initSpots();
  
  document.getElementById('driverWelcome').innerText = `Welcome, ${name}!`;
  document.getElementById('driverVehicleDisplay').innerText = vehicle;
  
  document.getElementById('driverAuth').style.display = 'none';
  document.getElementById('driverApp').style.display = 'block';
  renderDriver();
};

// Initialize spots
function initSpots() {
  state.spots = Array.from({length: state.user.capacity}, (_, i) => ({
    id: i + 1,
    status: "free"
  }));
}

// Owner render
function render(searchTerm = '') {
  document.getElementById('cap').innerText = state.spots.length;
  document.getElementById('reserved').innerText = state.spots.filter(s => s.status === "reserved").length;
  document.getElementById('booked').innerText = state.spots.filter(s => s.status === "booked").length;
  document.getElementById('parked').innerText = state.spots.filter(s => s.status === "parked").length;
  document.getElementById('cabs').innerText = state.spots.filter(s => s.status === "cab").length;
  document.getElementById('rev').innerText = "‚Çπ" + state.revenue;
  
  const grid = document.getElementById('grid');
  grid.innerHTML = "";
  
  let filteredSpots = state.spots.filter((s) => {
    const matchesSearch = searchTerm === '' || s.id.toString().includes(searchTerm);
    const matchesFilter = 
      state.filter === 'all' || 
      (state.filter === 'available' && s.status === 'free') ||
      (state.filter === 'occupied' && s.status !== 'free');
    return matchesSearch && matchesFilter;
  });
  
  filteredSpots.forEach((s) => {
    const realIndex = state.spots.findIndex(spot => spot.id === s.id);
    const d = document.createElement("div");
    let classes = "spot " + s.status;
    if (s.expiring) classes += " expiring";
    d.className = classes;
    
    let displayText = s.id;
    if (s.status === 'parked' || s.status === 'cab') {
      const parkedAt = new Date(s.parkedAt);
      const durationInSeconds = (new Date() - parkedAt) / 1000;
      const hours = Math.floor(durationInSeconds / 8);
      const minutes = Math.floor(((durationInSeconds % 8) / 8) * 60);
      displayText += `<br><span class="spot-timer">${hours}:${minutes.toString().padStart(2, '0')}</span>`;
    }
    
    d.innerHTML = displayText;
    d.onclick = () => selectSpot(realIndex);
    grid.appendChild(d);
  });
}

// Driver render
function renderDriver(searchTerm = '') {
  const availableSpots = state.spots.filter(s => s.status === 'free').length;
  const driverBookingsCount = state.spots.filter(s => s.status === 'cab' && s.driverBooked).length;
  
  document.getElementById('driverAvailable').innerText = availableSpots;
  document.getElementById('driverBookings').innerText = driverBookingsCount;
  document.getElementById('driverSpent').innerText = "‚Çπ" + state.driverSpent;
  
  const grid = document.getElementById('driverGrid');
  grid.innerHTML = "";
  
  let filteredSpots = state.spots.filter((s) => {
    const matchesSearch = searchTerm === '' || s.id.toString().includes(searchTerm);
    return matchesSearch;
  });
  
  filteredSpots.forEach((s) => {
    const realIndex = state.spots.findIndex(spot => spot.id === s.id);
    const d = document.createElement("div");
    
    let displayClass = 'spot ';
    if (s.status === 'free') {
      displayClass += 'free';
    } else if (s.status === 'cab' && s.driverBooked) {
      displayClass += 'cab';
    } else {
      displayClass += 'booked'; // Show as booked/occupied for driver
    }
    
    d.className = displayClass;
    
    let displayText = s.id;
    if (s.status === 'cab' && s.driverBooked) {
      const parkedAt = new Date(s.parkedAt);
      const durationInSeconds = (new Date() - parkedAt) / 1000;
      const hours = Math.floor(durationInSeconds / 8);
      const minutes = Math.floor(((durationInSeconds % 8) / 8) * 60);
      displayText += `<br><span class="spot-timer">${hours}:${minutes.toString().padStart(2, '0')}</span>`;
    }
    
    d.innerHTML = displayText;
    
    if (s.status === 'free') {
      d.onclick = () => selectDriverSpot(realIndex);
    } else if (s.status === 'cab' && s.driverBooked) {
      d.onclick = () => showDriverParkedInfo(realIndex);
    }
    
    grid.appendChild(d);
  });
}

// Owner spot selection
function selectSpot(i) {
  const spot = state.spots[i];
  document.getElementById('selectedSpotNumber').innerText = '#' + spot.id;
  
  if (spot.status === 'reserved') {
    alert('This spot is reserved and cannot be modified.');
    return;
  }
  
  if (spot.status === 'booked') {
    state.selected = i;
    document.getElementById('bookedSpotNumber').innerText = '#' + spot.id;
    const hours = spot.approxHours || 2;
    document.getElementById('bookedHours').innerText = hours + ' hour' + (hours > 1 ? 's' : '');
    document.getElementById('bookedAmount').innerText = '‚Çπ' + (hours * 50);
    document.getElementById('bookedInfoModal').style.display = "flex";
    return;
  }
  
  if (spot.status === 'parked' || spot.status === 'cab') {
    state.selected = i;
    const parkedAt = new Date(spot.parkedAt);
    const durationInSeconds = (new Date() - parkedAt) / 1000;
    const hours = Math.floor(durationInSeconds / 8);
    const minutes = Math.floor(((durationInSeconds % 8) / 8) * 60);
    document.getElementById('parkedTime').innerText = `${hours}h ${minutes}m`;
    document.getElementById('infoSpotNumber').innerText = '#' + spot.id;
    
    const rate = spot.status === 'cab' ? 20 : 50;
    const currentHours = Math.max(1, hours);
    document.getElementById('currentCharges').innerText = `‚Çπ${currentHours * rate}`;
    
    document.getElementById('parkedInfoModal').style.display = "flex";
    return;
  }
  
  if (spot.status !== "free") return;
  
  state.spots[i].status = "reserved";
  state.selected = i;
  document.getElementById('hours').value = 2;
  document.getElementById('hoursDisplay').innerText = 2;
  document.getElementById('prePayAmount').innerText = 100;
  document.getElementById('bookModal').style.display = "flex";
  render();
}

// Driver spot selection
function selectDriverSpot(i) {
  const spot = state.spots[i];
  if (spot.status !== 'free') {
    alert('This spot is not available');
    return;
  }
  
  state.selected = i;
  state.spots[i].status = "reserved";
  document.getElementById('driverSelectedSpotNumber').innerText = '#' + spot.id;
  document.getElementById('driverHours').value = 2;
  document.getElementById('driverHoursDisplay').innerText = 2;
  document.getElementById('driverPayAmount').innerText = 40;
  document.getElementById('driverSavings').innerText = 60;
  document.getElementById('driverBookModal').style.display = "flex";
  renderDriver();
}

// Driver parked info
function showDriverParkedInfo(i) {
  const spot = state.spots[i];
  state.selected = i;
  
  const parkedAt = new Date(spot.parkedAt);
  const durationInSeconds = (new Date() - parkedAt) / 1000;
  const hours = Math.floor(durationInSeconds / 8);
  const minutes = Math.floor(((durationInSeconds % 8) / 8) * 60);
  document.getElementById('parkedTime').innerText = `${hours}h ${minutes}m`;
  document.getElementById('infoSpotNumber').innerText = '#' + spot.id;
  
  const currentHours = Math.max(1, hours);
  document.getElementById('currentCharges').innerText = `‚Çπ${currentHours * 20}`;
  
  document.getElementById('parkedInfoModal').style.display = "flex";
}

// Hour selectors - Owner
document.getElementById('hourPlus').onclick = () => {
  let current = parseInt(document.getElementById('hours').value);
  current++;
  document.getElementById('hours').value = current;
  document.getElementById('hoursDisplay').innerText = current;
  document.getElementById('prePayAmount').innerText = current * 50;
};

document.getElementById('hourMinus').onclick = () => {
  let current = parseInt(document.getElementById('hours').value);
  if (current > 1) {
    current--;
    document.getElementById('hours').value = current;
    document.getElementById('hoursDisplay').innerText = current;
    document.getElementById('prePayAmount').innerText = current * 50;
  }
};

// Hour selectors - Driver
document.getElementById('driverHourPlus').onclick = () => {
  let current = parseInt(document.getElementById('driverHours').value);
  current++;
  document.getElementById('driverHours').value = current;
  document.getElementById('driverHoursDisplay').innerText = current;
  document.getElementById('driverPayAmount').innerText = current * 20;
  document.getElementById('driverSavings').innerText = current * 30;
};

document.getElementById('driverHourMinus').onclick = () => {
  let current = parseInt(document.getElementById('driverHours').value);
  if (current > 1) {
    current--;
    document.getElementById('driverHours').value = current;
    document.getElementById('driverHoursDisplay').innerText = current;
    document.getElementById('driverPayAmount').innerText = current * 20;
    document.getElementById('driverSavings').innerText = current * 30;
  }
};

// Back buttons
document.getElementById('backButton').onclick = () => {
  if (state.selected !== null) {
    state.spots[state.selected].status = "free";
    state.selected = null;
  }
  document.getElementById('bookModal').style.display = "none";
  render();
};

document.getElementById('driverBackButton').onclick = () => {
  if (state.selected !== null) {
    state.spots[state.selected].status = "free";
    state.selected = null;
  }
  document.getElementById('driverBookModal').style.display = "none";
  renderDriver();
};

// Owner booking actions
document.getElementById('goPay').onclick = () => {
  const amount = parseInt(document.getElementById('hours').value) * 50;
  document.getElementById('amt').innerText = amount;
  document.getElementById('amt2').innerText = amount;
  document.getElementById('bookModal').style.display = "none";
  document.getElementById('payModal').style.display = "flex";
};

document.getElementById('onsitePark').onclick = () => {
  const spot = state.spots[state.selected];
  spot.status = "parked";
  spot.parkedAt = new Date().toISOString();
  spot.billedHours = 0;
  spot.approxHours = parseInt(document.getElementById('hours').value);
  document.getElementById('bookModal').style.display = "none";
  state.selected = null;
  render();
};

document.getElementById('cabPark').onclick = () => {
  const spot = state.spots[state.selected];
  spot.status = "cab";
  spot.parkedAt = new Date().toISOString();
  spot.billedHours = 0;
  spot.approxHours = parseInt(document.getElementById('hours').value);
  document.getElementById('bookModal').style.display = "none";
  state.selected = null;
  render();
};

document.getElementById('reserveSpot').onclick = () => {
  const spot = state.spots[state.selected];
  spot.status = "reserved";
  spot.approxHours = parseInt(document.getElementById('hours').value);
  document.getElementById('bookModal').style.display = "none";
  state.selected = null;
  render();
};

// Driver payment
document.getElementById('driverPayNow').onclick = () => {
  const hours = parseInt(document.getElementById('driverHours').value);
  const amount = hours * 20;
  document.getElementById('amt').innerText = amount;
  document.getElementById('amt2').innerText = amount;
  document.getElementById('driverBookModal').style.display = "none";
  document.getElementById('payModal').style.display = "flex";
};

// Payment tabs
document.querySelectorAll('.payment-tab').forEach(tab => {
  tab.onclick = function() {
    document.querySelectorAll('.payment-tab').forEach(t => {
      t.classList.remove('active');
      t.style.borderBottomColor = 'transparent';
      t.style.color = '#666';
      t.style.fontWeight = '400';
    });
    
    this.classList.add('active');
    this.style.borderBottomColor = '#528FF0';
    this.style.color = '#528FF0';
    this.style.fontWeight = '600';
    
    document.querySelectorAll('.payment-method').forEach(method => {
      method.style.display = 'none';
    });
    
    const tabType = this.getAttribute('data-tab');
    if (tabType === 'card') {
      document.getElementById('cardPayment').style.display = 'block';
    } else if (tabType === 'upi') {
      document.getElementById('upiPayment').style.display = 'block';
    } else if (tabType === 'netbanking') {
      document.getElementById('netbankingPayment').style.display = 'block';
    }
  };
});

// Card formatting
document.getElementById('cardNumber').oninput = function() {
  let value = this.value.replace(/\s/g, '');
  let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
  this.value = formattedValue;
};

document.getElementById('cardExpiry').oninput = function() {
  let value = this.value.replace(/\D/g, '');
  if (value.length >= 2) {
    value = value.slice(0, 2) + '/' + value.slice(2, 4);
  }
  this.value = value;
};

document.getElementById('cardCVV').oninput = function() {
  this.value = this.value.replace(/\D/g, '').slice(0, 3);
};

// UPI options
document.querySelectorAll('.upi-option').forEach(option => {
  option.onmouseover = function() {
    this.style.borderColor = '#528FF0';
    this.style.transform = 'scale(1.05)';
  };
  option.onmouseout = function() {
    this.style.borderColor = '#ddd';
    this.style.transform = 'scale(1)';
  };
  option.onclick = function() {
    document.getElementById('payNowBtn').click();
  };
});

document.getElementById('cancelPayBtn').onclick = () => {
  document.getElementById('payModal').style.display = 'none';
  if (state.isDriver) {
    document.getElementById('driverBookModal').style.display = 'flex';
  } else {
    document.getElementById('bookModal').style.display = 'flex';
  }
};

// Parked info modal
document.getElementById('closeParkedInfo').onclick = () => {
  document.getElementById('parkedInfoModal').style.display = "none";
  state.selected = null;
};

document.getElementById('parkOutButton').onclick = () => {
  const spot = state.spots[state.selected];
  const parkedAt = new Date(spot.parkedAt);
  const durationInSeconds = (new Date() - parkedAt) / 1000;
  const hoursParked = Math.max(1, Math.ceil(durationInSeconds / 8));
  const rate = spot.status === 'cab' ? 20 : 50;
  const finalCharge = hoursParked * rate;
  
  state.revenue += (finalCharge - (spot.billedHours * rate));
  
  spot.status = "free";
  spot.parkedAt = null;
  spot.billedHours = 0;
  spot.approxHours = null;
  spot.expiring = false;
  spot.driverBooked = false;
  
  document.getElementById('parkedInfoModal').style.display = "none";
  state.selected = null;
  
  if (state.isDriver) {
    renderDriver();
  } else {
    render();
  }
  
  alert(`Checkout complete! Total charge: ‚Çπ${finalCharge}`);
};

// Booked info modal
document.getElementById('closeBookedInfo').onclick = () => {
  document.getElementById('bookedInfoModal').style.display = "none";
  state.selected = null;
};

document.getElementById('cancelBooking').onclick = () => {
  const spot = state.spots[state.selected];
  const hours = spot.approxHours || 2;
  const refundAmount = hours * 50;
  
  if (confirm(`Are you sure you want to cancel this booking? ‚Çπ${refundAmount} will be refunded.`)) {
    state.revenue -= refundAmount;
    spot.status = "free";
    spot.approxHours = null;
    document.getElementById('bookedInfoModal').style.display = "none";
    state.selected = null;
    render();
    alert(`Booking cancelled. ‚Çπ${refundAmount} refunded successfully.`);
  }
};

// Search and filters - Owner
document.getElementById('searchSpot').oninput = (e) => {
  render(e.target.value);
};

document.getElementById('filterAll').onclick = () => {
  state.filter = 'all';
  render();
};

document.getElementById('filterAvailable').onclick = () => {
  state.filter = 'available';
  render();
};

document.getElementById('filterOccupied').onclick = () => {
  state.filter = 'occupied';
  render();
};

// Search and filters - Driver
document.getElementById('driverSearchSpot').oninput = (e) => {
  renderDriver(e.target.value);
};

document.getElementById('driverFilterAll').onclick = () => {
  renderDriver();
};

document.getElementById('driverFilterAvailable').onclick = () => {
  const grid = document.getElementById('driverGrid');
  grid.innerHTML = "";
  
  state.spots.filter(s => s.status === 'free').forEach((s) => {
    const realIndex = state.spots.findIndex(spot => spot.id === s.id);
    const d = document.createElement("div");
    d.className = "spot free";
    d.innerHTML = s.id;
    d.onclick = () => selectDriverSpot(realIndex);
    grid.appendChild(d);
  });
};

// Timer updates
function updateTimers() {
  let revenueToAdd = 0;
  const now = new Date();
  
  state.spots.forEach(spot => {
    if ((spot.status === 'parked' || spot.status === 'cab') && spot.parkedAt) {
      const parkedDate = new Date(spot.parkedAt);
      const durationInSeconds = (now - parkedDate) / 1000;
      const hoursParked = Math.floor(durationInSeconds / 8);
      
      if (hoursParked > spot.billedHours) {
        const hoursToBill = hoursParked - spot.billedHours;
        revenueToAdd += hoursToBill * (spot.status === 'cab' ? 20 : 50);
        spot.billedHours = hoursParked;
      }
      
      if (spot.approxHours && hoursParked >= spot.approxHours) {
        spot.expiring = true;
      } else {
        spot.expiring = false;
      }
    }
  });
  
  if (revenueToAdd > 0) {
    state.revenue += revenueToAdd;
  }
  
  if (state.isDriver) {
    renderDriver(document.getElementById('driverSearchSpot').value);
  } else {
    render(document.getElementById('searchSpot').value);
  }
}

setInterval(updateTimers, 1000);

// Payment processing with netbanking support
document.getElementById('payNowBtn').onclick = () => {
  const activeTab = document.querySelector('.payment-tab.active').getAttribute('data-tab');
  let isValid = false;
  let message = '';
  
  if (activeTab === 'card') {
    const cardNum = document.getElementById('cardNumber').value.replace(/\s/g, '');
    const expiry = document.getElementById('cardExpiry').value;
    const cvv = document.getElementById('cardCVV').value;
    const name = document.getElementById('cardName').value;
    
    if (!cardNum || cardNum.length < 16) {
      message = 'Please enter a valid 16-digit card number';
    } else if (!expiry || expiry.length < 5) {
      message = 'Please enter valid expiry date (MM/YY)';
    } else if (!cvv || cvv.length < 3) {
      message = 'Please enter valid CVV';
    } else if (!name || name.trim().length < 3) {
      message = 'Please enter cardholder name';
    } else {
      isValid = true;
    }
  } else if (activeTab === 'upi') {
    const upiId = document.getElementById('upiId').value;
    if (!upiId || !upiId.includes('@')) {
      message = 'Please enter a valid UPI ID or select a UPI app';
    } else {
      isValid = true;
    }
  } else if (activeTab === 'netbanking') {
    const bank = document.getElementById('bankSelect').value;
    if (!bank) {
      message = 'Please select your bank';
    } else {
      // Show bank login screen
      const amount = document.getElementById('amt').innerText;
      document.querySelectorAll('.bank-amount').forEach(el => {
        el.innerText = amount;
      });
      
      document.getElementById('payModal').style.display = 'none';
      
      // Open corresponding bank modal
      const bankModals = {
        'sbi': 'sbiBankModal',
        'hdfc': 'hdfcBankModal',
        'icici': 'iciciBankModal',
        'axis': 'axisBankModal',
        'kotak': 'kotakBankModal',
        'pnb': 'pnbBankModal',
        'other': 'sbiBankModal' // default to SBI for "other banks"
      };
      
      const modalId = bankModals[bank] || 'sbiBankModal';
      document.getElementById(modalId).style.display = 'flex';
      return; // Exit here to show bank screen
    }
  }
  
  if (!isValid) {
    alert(message);
    return;
  }
  
  const payButton = document.getElementById('payNowBtn');
  const originalText = payButton.innerHTML;
  payButton.innerHTML = '‚è≥ Processing...';
  payButton.disabled = true;
  payButton.style.opacity = '0.7';
  
  setTimeout(() => {
    const spot = state.spots[state.selected];
    
    if (state.isDriver) {
      const hours = parseInt(document.getElementById('driverHours').value);
      const amount = hours * 20;
      spot.status = "cab";
      spot.parkedAt = new Date().toISOString();
      spot.billedHours = 0;
      spot.approxHours = hours;
      spot.driverBooked = true;
      state.driverSpent += amount;
      state.revenue += amount;
      
      document.getElementById('payModal').style.display = "none";
      state.selected = null;
      renderDriver();
      alert('‚úì Payment successful! Your parking spot is booked at discounted rate.');
    } else {
      const hours = parseInt(document.getElementById('hours').value);
      spot.status = "booked";
      spot.approxHours = hours;
      state.revenue += hours * 50;
      
      document.getElementById('payModal').style.display = "none";
      state.selected = null;
      render();
      alert('‚úì Payment successful! Spot booked.');
    }
    
    payButton.innerHTML = originalText;
    payButton.disabled = false;
    payButton.style.opacity = '1';
  }, 2000);
};

// Bank login button handlers
document.querySelectorAll('.bank-login-btn').forEach(btn => {
  btn.onclick = function() {
    const bankName = this.getAttribute('data-bank');
    const inputs = this.closest('.card').querySelectorAll('.bank-input');
    let allFilled = true;
    
    inputs.forEach(input => {
      if (!input.value.trim()) {
        allFilled = false;
      }
    });
    
    if (!allFilled) {
      alert('Please fill in all fields');
      return;
    }
    
    // Show processing
    const originalText = this.innerHTML;
    this.innerHTML = '‚è≥ Processing...';
    this.disabled = true;
    this.style.opacity = '0.7';
    
    setTimeout(() => {
      // Close bank modal
      document.querySelectorAll('[id$="BankModal"]').forEach(modal => {
        modal.style.display = 'none';
      });
      
      // Clear bank inputs
      inputs.forEach(input => {
        input.value = '';
      });
      
      // Complete payment
      const spot = state.spots[state.selected];
      
      if (state.isDriver) {
        const hours = parseInt(document.getElementById('driverHours').value);
        const amount = hours * 20;
        spot.status = "cab";
        spot.parkedAt = new Date().toISOString();
        spot.billedHours = 0;
        spot.approxHours = hours;
        spot.driverBooked = true;
        state.driverSpent += amount;
        state.revenue += amount;
        
        document.getElementById('bankSelect').value = '';
        state.selected = null;
        renderDriver();
        alert('‚úì Payment successful via Netbanking! Your parking spot is booked at discounted rate.');
      } else {
        const hours = parseInt(document.getElementById('hours').value);
        spot.status = "booked";
        spot.approxHours = hours;
        state.revenue += hours * 50;
        
        document.getElementById('bankSelect').value = '';
        state.selected = null;
        render();
        alert('‚úì Payment successful via Netbanking! Spot booked.');
      }
      
      // Reset button
      this.innerHTML = originalText;
      this.disabled = false;
      this.style.opacity = '1';
    }, 2000);
  };
});

// Bank cancel button handlers
document.querySelectorAll('.bank-cancel-btn').forEach(btn => {
  btn.onclick = function() {
    // Close all bank modals
    document.querySelectorAll('[id$="BankModal"]').forEach(modal => {
      modal.style.display = 'none';
    });
    
    // Clear inputs
    this.closest('.card').querySelectorAll('.bank-input').forEach(input => {
      input.value = '';
    });
    
    // Go back to payment modal
    document.getElementById('payModal').style.display = 'flex';
  };
});
</script>

</body>
</html>